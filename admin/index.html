<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة تحكم فارا - Admin Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f7fa;
            color: #333;
            direction: rtl;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, #2d2871 0%, #1f1a5a 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-right: 4px solid #2d2871;
        }

        .stat-card h3 {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .stat-card .value {
            font-size: 32px;
            font-weight: bold;
            color: #2d2871;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            background: white;
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .tab {
            padding: 12px 24px;
            background: #f0f0f0;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }

        .tab.active {
            background: #2d2871;
            color: white;
        }

        .tab:hover {
            background: #1f1a5a;
            color: white;
        }

        .content-section {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: none;
        }

        .content-section.active {
            display: block;
        }

        .search-bar {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
        }

        .search-bar input {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
        }

        .search-bar button {
            padding: 12px 24px;
            background: #2d2871;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        table th,
        table td {
            padding: 12px;
            text-align: right;
            border-bottom: 1px solid #eee;
        }

        table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #2d2871;
        }

        table tr:hover {
            background: #f8f9fa;
        }

        .badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge.active {
            background: #d4edda;
            color: #155724;
        }

        .badge.inactive {
            background: #f8d7da;
            color: #721c24;
        }

        .badge.pending {
            background: #fff3cd;
            color: #856404;
        }

        .badge.completed {
            background: #d1ecf1;
            color: #0c5460;
        }

        .btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            margin: 0 2px;
        }

        .btn-edit {
            background: #17a2b8;
            color: white;
        }

        .btn-delete {
            background: #dc3545;
            color: white;
        }

        .btn-toggle {
            background: #28a745;
            color: white;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }

        .pagination button {
            padding: 8px 16px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 6px;
            cursor: pointer;
        }

        .pagination button.active {
            background: #2d2871;
            color: white;
            border-color: #2d2871;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>لوحة تحكم فارا</h1>
            <p>إدارة النظام والبيانات</p>
        </header>

        <div class="stats-grid" id="statsGrid">
            <div class="stat-card">
                <h3>إجمالي المستخدمين</h3>
                <div class="value" id="totalUsers">-</div>
            </div>
            <div class="stat-card">
                <h3>إجمالي القاعات</h3>
                <div class="value" id="totalVenues">-</div>
            </div>
            <div class="stat-card">
                <h3>إجمالي الخدمات</h3>
                <div class="value" id="totalServices">-</div>
            </div>
            <div class="stat-card">
                <h3>إجمالي الحجوزات</h3>
                <div class="value" id="totalBookings">-</div>
            </div>
            <div class="stat-card">
                <h3>إجمالي الإيرادات</h3>
                <div class="value" id="totalRevenue">-</div>
            </div>
            <div class="stat-card">
                <h3>حجوزات قيد الانتظار</h3>
                <div class="value" id="pendingBookings">-</div>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('users')">المستخدمين</button>
            <button class="tab" onclick="showTab('venues')">القاعات</button>
            <button class="tab" onclick="showTab('services')">الخدمات</button>
            <button class="tab" onclick="showTab('bookings')">الحجوزات</button>
        </div>

        <div id="usersSection" class="content-section active">
            <div class="search-bar">
                <input type="text" id="userSearch" placeholder="بحث في المستخدمين...">
                <button onclick="loadUsers()">بحث</button>
            </div>
            <div id="usersTable"></div>
        </div>

        <div id="venuesSection" class="content-section">
            <div class="search-bar">
                <input type="text" id="venueSearch" placeholder="بحث في القاعات...">
                <button onclick="loadVenues()">بحث</button>
            </div>
            <div id="venuesTable"></div>
        </div>

        <div id="servicesSection" class="content-section">
            <div class="search-bar">
                <input type="text" id="serviceSearch" placeholder="بحث في الخدمات...">
                <button onclick="loadServices()">بحث</button>
            </div>
            <div id="servicesTable"></div>
        </div>

        <div id="bookingsSection" class="content-section">
            <div class="search-bar">
                <input type="text" id="bookingSearch" placeholder="بحث في الحجوزات...">
                <button onclick="loadBookings()">بحث</button>
            </div>
            <div id="bookingsTable"></div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:5000/api';

        // Load dashboard stats
        async function loadStats() {
            try {
                const response = await fetch(`${API_URL}/admin/stats`);
                const data = await response.json();
                const stats = data.stats;

                document.getElementById('totalUsers').textContent = stats.totalUsers || 0;
                document.getElementById('totalVenues').textContent = stats.totalVenues || 0;
                document.getElementById('totalServices').textContent = stats.totalServices || 0;
                document.getElementById('totalBookings').textContent = stats.totalBookings || 0;
                document.getElementById('totalRevenue').textContent = (stats.totalRevenue || 0).toFixed(2) + ' $';
                document.getElementById('pendingBookings').textContent = stats.pendingBookings || 0;
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        // Tab switching
        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.content-section').forEach(section => section.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName + 'Section').classList.add('active');
            
            if (tabName === 'users') loadUsers();
            else if (tabName === 'venues') loadVenues();
            else if (tabName === 'services') loadServices();
            else if (tabName === 'bookings') loadBookings();
        }

        // Load users
        async function loadUsers() {
            const search = document.getElementById('userSearch').value;
            const tableDiv = document.getElementById('usersTable');
            tableDiv.innerHTML = '<div class="loading">جاري التحميل...</div>';

            try {
                const url = `${API_URL}/admin/users?search=${encodeURIComponent(search)}`;
                const response = await fetch(url);
                const data = await response.json();

                let html = '<table><thead><tr><th>الاسم</th><th>البريد</th><th>الهاتف</th><th>الدور</th><th>الموقع</th><th>تاريخ الإنشاء</th></tr></thead><tbody>';
                
                data.users.forEach(user => {
                    html += `<tr>
                        <td>${user.name || '-'}</td>
                        <td>${user.email || '-'}</td>
                        <td>${user.phone || '-'}</td>
                        <td><span class="badge">${user.role}</span></td>
                        <td>${user.location || '-'}</td>
                        <td>${new Date(user.createdAt).toLocaleDateString('ar-EG')}</td>
                    </tr>`;
                });
                
                html += '</tbody></table>';
                tableDiv.innerHTML = html;
            } catch (error) {
                tableDiv.innerHTML = '<div class="loading">خطأ في تحميل البيانات</div>';
                console.error('Error loading users:', error);
            }
        }

        // Load venues
        async function loadVenues() {
            const search = document.getElementById('venueSearch').value;
            const tableDiv = document.getElementById('venuesTable');
            tableDiv.innerHTML = '<div class="loading">جاري التحميل...</div>';

            try {
                const url = `${API_URL}/admin/venues?search=${encodeURIComponent(search)}`;
                const response = await fetch(url);
                const data = await response.json();

                let html = '<table><thead><tr><th>الاسم</th><th>المزود</th><th>السعر</th><th>التقييم</th><th>الحالة</th><th>الإجراءات</th></tr></thead><tbody>';
                
                data.venues.forEach(venue => {
                    const statusClass = venue.isActive ? 'active' : 'inactive';
                    html += `<tr>
                        <td>${venue.nameAr || venue.name}</td>
                        <td>${venue.provider?.name || '-'}</td>
                        <td>${venue.price} $</td>
                        <td>${venue.rating} (${venue.reviewCount})</td>
                        <td><span class="badge ${statusClass}">${venue.isActive ? 'نشط' : 'غير نشط'}</span></td>
                        <td>
                            <button class="btn btn-toggle" onclick="toggleVenueStatus('${venue.id}', ${!venue.isActive})">
                                ${venue.isActive ? 'تعطيل' : 'تفعيل'}
                            </button>
                            <button class="btn btn-delete" onclick="deleteVenue('${venue.id}')">حذف</button>
                        </td>
                    </tr>`;
                });
                
                html += '</tbody></table>';
                tableDiv.innerHTML = html;
            } catch (error) {
                tableDiv.innerHTML = '<div class="loading">خطأ في تحميل البيانات</div>';
                console.error('Error loading venues:', error);
            }
        }

        // Load services
        async function loadServices() {
            const search = document.getElementById('serviceSearch').value;
            const tableDiv = document.getElementById('servicesTable');
            tableDiv.innerHTML = '<div class="loading">جاري التحميل...</div>';

            try {
                const url = `${API_URL}/admin/services?search=${encodeURIComponent(search)}`;
                const response = await fetch(url);
                const data = await response.json();

                let html = '<table><thead><tr><th>الاسم</th><th>الفئة</th><th>المزود</th><th>السعر</th><th>التقييم</th><th>الحالة</th><th>الإجراءات</th></tr></thead><tbody>';
                
                data.services.forEach(service => {
                    const statusClass = service.isActive ? 'active' : 'inactive';
                    html += `<tr>
                        <td>${service.nameAr || service.name}</td>
                        <td>${service.category?.nameAr || service.category?.name || '-'}</td>
                        <td>${service.provider?.name || '-'}</td>
                        <td>${service.price} $</td>
                        <td>${service.rating} (${service.reviewCount})</td>
                        <td><span class="badge ${statusClass}">${service.isActive ? 'نشط' : 'غير نشط'}</span></td>
                        <td>
                            <button class="btn btn-toggle" onclick="toggleServiceStatus('${service.id}', ${!service.isActive})">
                                ${service.isActive ? 'تعطيل' : 'تفعيل'}
                            </button>
                            <button class="btn btn-delete" onclick="deleteService('${service.id}')">حذف</button>
                        </td>
                    </tr>`;
                });
                
                html += '</tbody></table>';
                tableDiv.innerHTML = html;
            } catch (error) {
                tableDiv.innerHTML = '<div class="loading">خطأ في تحميل البيانات</div>';
                console.error('Error loading services:', error);
            }
        }

        // Load bookings
        async function loadBookings() {
            const search = document.getElementById('bookingSearch').value;
            const tableDiv = document.getElementById('bookingsTable');
            tableDiv.innerHTML = '<div class="loading">جاري التحميل...</div>';

            try {
                const url = `${API_URL}/admin/bookings?search=${encodeURIComponent(search)}`;
                const response = await fetch(url);
                const data = await response.json();

                let html = '<table><thead><tr><th>رقم الحجز</th><th>العميل</th><th>القاعة</th><th>التاريخ</th><th>المبلغ</th><th>الحالة</th><th>الإجراءات</th></tr></thead><tbody>';
                
                data.bookings.forEach(booking => {
                    const statusClass = booking.status.toLowerCase();
                    html += `<tr>
                        <td>${booking.bookingNumber}</td>
                        <td>${booking.customer?.name || '-'}</td>
                        <td>${booking.venue?.nameAr || booking.venue?.name || '-'}</td>
                        <td>${new Date(booking.date).toLocaleDateString('ar-EG')}</td>
                        <td>${booking.finalAmount} $</td>
                        <td><span class="badge ${statusClass}">${booking.status}</span></td>
                        <td>
                            <button class="btn btn-edit" onclick="updateBookingStatus('${booking.id}', 'CONFIRMED')">تأكيد</button>
                            <button class="btn btn-delete" onclick="updateBookingStatus('${booking.id}', 'CANCELLED')">إلغاء</button>
                        </td>
                    </tr>`;
                });
                
                html += '</tbody></table>';
                tableDiv.innerHTML = html;
            } catch (error) {
                tableDiv.innerHTML = '<div class="loading">خطأ في تحميل البيانات</div>';
                console.error('Error loading bookings:', error);
            }
        }

        // Toggle venue status
        async function toggleVenueStatus(id, isActive) {
            try {
                const response = await fetch(`${API_URL}/admin/venues/${id}/status`, {
                    method: 'PATCH',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ isActive })
                });
                if (response.ok) {
                    loadVenues();
                }
            } catch (error) {
                console.error('Error toggling venue status:', error);
            }
        }

        // Toggle service status
        async function toggleServiceStatus(id, isActive) {
            try {
                const response = await fetch(`${API_URL}/admin/services/${id}/status`, {
                    method: 'PATCH',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ isActive })
                });
                if (response.ok) {
                    loadServices();
                }
            } catch (error) {
                console.error('Error toggling service status:', error);
            }
        }

        // Delete venue
        async function deleteVenue(id) {
            if (!confirm('هل أنت متأكد من حذف هذه القاعة؟')) return;
            try {
                const response = await fetch(`${API_URL}/admin/venues/${id}`, {
                    method: 'DELETE'
                });
                if (response.ok) {
                    loadVenues();
                }
            } catch (error) {
                console.error('Error deleting venue:', error);
            }
        }

        // Delete service
        async function deleteService(id) {
            if (!confirm('هل أنت متأكد من حذف هذه الخدمة؟')) return;
            try {
                const response = await fetch(`${API_URL}/admin/services/${id}`, {
                    method: 'DELETE'
                });
                if (response.ok) {
                    loadServices();
                }
            } catch (error) {
                console.error('Error deleting service:', error);
            }
        }

        // Update booking status
        async function updateBookingStatus(id, status) {
            try {
                const response = await fetch(`${API_URL}/admin/bookings/${id}/status`, {
                    method: 'PATCH',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ status })
                });
                if (response.ok) {
                    loadBookings();
                }
            } catch (error) {
                console.error('Error updating booking status:', error);
            }
        }

        // Initialize
        loadStats();
        loadUsers();
    </script>
</body>
</html>




